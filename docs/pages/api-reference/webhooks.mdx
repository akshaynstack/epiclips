# Webhooks

Receive real-time notifications when jobs complete.

## Configuration

Set these environment variables:

```env
WEBHOOK_URL=https://your-api.com/webhook
WEBHOOK_SECRET=your_secret_key
```

## Webhook Payload

When a job completes, Epiclips sends a POST request:

```json
{
  "event": "job.completed",
  "job_id": "abc123-def456-...",
  "external_job_id": "your-reference-id",
  "status": "completed",
  "output": {
    "clips": [
      {
        "clip_index": 0,
        "s3_url": "https://...",
        "duration_ms": 45000,
        "virality_score": 0.92
      }
    ],
    "processing_time_seconds": 182.5
  },
  "timestamp": "2024-01-15T10:30:00Z"
}
```

## Events

| Event | Description |
|-------|-------------|
| `job.completed` | Job finished successfully |
| `job.failed` | Job failed with error |
| `job.progress` | Progress update (optional) |

## Signature Verification

Webhooks include an HMAC signature for verification:

```
X-Webhook-Signature: sha256=abc123...
```

Verify with:

```python
import hmac
import hashlib

def verify_signature(payload: bytes, signature: str, secret: str) -> bool:
    expected = hmac.new(
        secret.encode(),
        payload,
        hashlib.sha256
    ).hexdigest()
    return hmac.compare_digest(f"sha256={expected}", signature)
```

## Retry Policy

- Failed webhooks are retried 3 times
- Exponential backoff: 1s, 5s, 30s
- Webhook must respond with 2xx within 10 seconds
